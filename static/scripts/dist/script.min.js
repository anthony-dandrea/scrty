$(function(){
 function checkAuth(){$.getJSON('/remote-logout',function(data){if(data.response==false){window.location='/login';}}).fail(function(error){ window.location='/login';}); setTimeout(function(){checkAuth();},3000);}
checkAuth();});$(function(){ $(document).on('click','[data-delete-pass]',function(e){e.preventDefault();var app=$(this).attr('data-app');delete localStorage[app];$(this).closest('tr').slideUp().remove();});});$(function(){ function logout(){$.getJSON('/logout',function(data){if(data.response==true){
 location.reload();}else{alert('Error: Logout failure.')}}).fail(function(){alert('Error: Server error while logging out.')});} 
$('#logout').on('click',function(e){e.preventDefault();logout();});});$(function(){ function copyToClipboard(text){window.prompt("Copy to clipboard: Ctrl+C/Cmd+C, Enter",text);} 
$(document).on('click','[data-get-pass]',function(e){e.preventDefault();var app=$(this).attr('data-app'),password=localStorage[app],csrf=$('[name="_csrf_token"]').val();$.post('/decrypt-password',{'password':password,'_csrf_token':csrf},function(data){if(data.success){copyToClipboard(data.decrypted_password);}else{alert('Error: Unable to decrypt password.');}}).fail(function(){alert('Error: Server error.')});});});$(function(){ function addNew(app){var template=$('#passtemplate').html();template=template.replace(/appName/g,app);$('tr').first().after(template);}
 
$('#password_encrypt').on('submit',function(e){e.preventDefault(); var app=$('#app').val();if(!localStorage[app]){var $self=$(this),formData=$self.serialize();$.post('/encrypt-password',formData,function(data){if(data.success){var password=data.encrypted_password;localStorage.setItem(app,password);addNew(app);$self.find('input[type=text], input[type=password]').val('');}else{alert('Error: Unable to encrypt and save password.');}}).fail(function(){alert('Error: Server error.');});}else{alert('Pick a new app/site or delete existing first.')}});});$(function(){
 var template=$('#passtemplate').html();$.each(localStorage,function(idx){var markup=template;markup=markup.replace(/appName/g,idx);$('tr').first().after(markup);});});